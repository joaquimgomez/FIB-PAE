<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>CVEModule Debugger</title>
  </head>

  <body>
    <h2>CVEModule Debugger</h2>

    <p id="status-opencv">OpenCV.js is loading...</p>
    <p id="status-CVE">CVEModule.mjs is loading...</p>
    <p id="status-tesseract">tesseract.js is loading...</p>

    <div>
      <div class="inputoutput">
        <img id="imageSrc" alt="No Image" />
        <div class="caption">imageSrc <input type="file" id="fileInput" name="file"/>
        </div>
      </div>

      <div class="inputoutput">
        <canvas id="canvasOutput" ></canvas>
        <div class="caption">canvasOutput</div>
      </div>
    </div>
    
    <!-- SCRIPTS -->
    <!-- LOAD FUNCTIONS -->
    <script type="text/javascript">
      function onOpenCvReady() {
        document.getElementById('status-opencv').innerHTML = 'OpenCV.js is ready.';
      }

      function onTesseractReady() {
        document.getElementById('status-tesseract').innerHTML = 'tesseract.js is ready.';
      }

      function onCVEMReady() {
        document.getElementById('status-CVE').innerHTML = 'CVEModule.mjs is ready.';
      }
    
    </script>

    <!-- CVEModule -->
    <script src="CVEModule.mjs" onload="onCVEMReady();" type="text/javascript"></script>

    <!-- OpenCV library -->
    <script async src="https://docs.opencv.org/master/opencv.js" onload="onOpenCvReady();" type="text/javascript"></script>

    <!-- Tesseract library -->
    <script async src='https://unpkg.com/tesseract.js@v2.1.0/dist/tesseract.min.js' onload="onTesseractReady();"></script>

    <!-- Debugger Script -->
    <script type="text/javascript">
      let imgElement = document.getElementById('imageSrc');
      let inputElement = document.getElementById('fileInput');

      inputElement.addEventListener('change', (e) => {
        imgElement.src = URL.createObjectURL(e.target.files[0]);
      }, false);

      imgElement.onload = function() {
        let mat = cv.imread(imgElement);

        // Debug Computer Vision Engine Module
        let cve = new ComputerVisionEngine(imgElement);
        mat = cve.run(true);

        cv.imshow('canvasOutput', mat);

        //mat.delete();
      };
    </script>

    
  </body>
</html>
